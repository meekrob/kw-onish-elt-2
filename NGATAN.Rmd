---
title: "GATA hexamers"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library("factoextra")
library("ade4")
library(dplyr)
```

## Background

The transcription factor ELT-2 is known to bind the sequence TGATAA with highest affinity. However, other variants of the NGATAN motif may contribute to the regulatory logic recognized by ELT-2.

Here is an analysis of roughly 10,000 DNA sequences that ELT-2 binds in any of three developmental stages, as determined by ChIP-seq.

```{r show data}
ngatan.by.peak = readRDS("ngatan.by.peak.rds") # a "peak" is the entity identified by ChIP-seq analysis.  A peak is d
dim(ngatan.by.peak)
ngatan.by.peak[1:3,]
ngatan.tbl = as.data.frame(ngatan.by.peak)
colnames(ngatan.tbl) <- c('region','hexamer','count')
totals = ngatan.tbl %>% group_by(hexamer) %>% summarize(total.hex = sum(count)) 
ggplot(totals, aes(x=reorder(hexamer,-total.hex),y=total.hex)) + geom_col() +theme(axis.text.x = element_text(angle = 90))
```
As expected, TGATAA is the most common motif overall. Others, especially AGATAA, have been studied as secondary targets.


How does the occurance of GATA variants compare with those counted in randomly permuted regions?

```{r permuted regions}
permuted_NGATAN.tab = readRDS("permuted_NGATAN.tab.rds")
permuted_10.counts = colSums(permuted_NGATAN.tab)
ave_hexamer_count = round(sum(permuted_10.counts)/10)
ELT2_binding_counts = colSums(ngatan.by.peak)
# scale the permuted counts to the average hexamer count size
permuted_10.prop = permuted_10.counts/sum(permuted_10.counts)
permuted_10.sim = round(permuted_10.prop * ave_hexamer_count)
ELT2_hexamers_vs_random_regions = rbind(ELT2_binding_counts, permuted_10.sim)
mosaicplot(ELT2_hexamers_vs_random_regions, shade=T, las=1, type="pearson", cex.axis=.7)
```

### PCA analysis: Contribution of secondary GATA variants
```{r thresholding}
variance.by.peak = apply(ngatan.by.peak, 1, var)
for (upper_quantile in c(.25,.05,.01))
{
  upper.variance.i = variance.by.peak >= quantile(1-upper_quantile, type=1)
  ngatan.upper.tbl = as.data.frame(ngatan.by.peak[upper.variance.i,])
  colnames(ngatan.upper.tbl) <- c('region','hexamer','count')
  totals.upper = ngatan.upper.tbl %>% group_by(hexamer) %>% summarize(total.hex = sum(count))
  plot<- ggplot(totals.upper, aes(x=reorder(hexamer,-total.hex),y=total.hex)) + geom_col() +theme(axis.text.x = element_text(angle = 90)) + ggtitle(sprintf("top %.0f%% by variance", upper_quantile*100))
  print(plot)
}
```
Variance thresholds do not appear do select for changes in relative occurance of the motifs.

---




```{r PCA}
ngatan.pca = princomp(ngatan.by.peak)
# The ade4 PCA implementation returns an error
# > ngatan.dudi.pca = dudi.pca(ngatan.by.peak)
# Error in v * row.w : non-numeric argument to binary operator

fviz_pca_biplot(ngatan.pca, label="var") + ggtitle("")

fviz_pca_biplot(ngatan.pca, axes=c(1,3), label="var") + ggtitle("")

```
The data appear in strips, probably because it is count data.

Although much of the variance is explained by TGATAA, AGATAA and TGATAT appear to contribute orthogonally to TGATAA, and to each other.

Let's look at this again by considering everything but TGATAA.
```{r PCA_nonTGATAA}
nonTGATAA.pca = princomp(ngatan.by.peak[,base::grep("TGATAA", colnames(ngatan.by.peak),invert=T)])

fviz_pca_biplot(nonTGATAA.pca, label="var") + ggtitle("TGATAA excluded")

fviz_pca_biplot(nonTGATAA.pca, axes=c(1,3), label="var") + ggtitle("TGATAA excluded")
```





``` {r co-occurance}

library(ymse)

ngatan.cooc = pairwise(ngatan.by.peak, function(x,y) sum(x*y > 0))

```